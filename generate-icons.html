<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Icon Generator</title>
    <style>
        body {
            font-family: sans-serif;
            background: #1a1d2e;
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background: #252836;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        .preview-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: flex-end;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .icon-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        canvas {
            border: 1px solid rgba(255,255,255,0.1);
            background: transparent;
            background-image: linear-gradient(45deg, #333 25%, transparent 25%), linear-gradient(-45deg, #333 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #333 75%), linear-gradient(-45deg, transparent 75%, #333 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        button {
            padding: 10px 20px;
            background: #00d4aa;
            border: none;
            border-radius: 6px;
            color: #0a1f2e;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
        }
        button:hover {
            background: #00b894;
        }
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            text-align: left;
        }
        .control-group {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        label { min-width: 100px; }
        input[type="color"] { border: none; height: 30px; width: 50px; cursor: pointer; }
        .file-input-wrapper {
            margin-bottom: 20px;
            border: 2px dashed rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Extension Icon Generator</h1>
        
        <div class="file-input-wrapper">
            <p style="margin-top: 0;">1. Select your SVG file:</p>
            <input type="file" id="svgInput" accept=".svg">
            <p style="font-size: 12px; opacity: 0.7; margin-bottom: 0;">(Or use the default embedded icon)</p>
        </div>
        
        <div class="controls">
            <p style="margin-top: 0; margin-bottom: 10px;">2. Customize:</p>
            <div class="control-group">
                <label>Icon Color:</label>
                <input type="color" id="iconColor" value="#ffffff">
            </div>
            <div class="control-group">
                <label>Background:</label>
                <input type="color" id="bgColor" value="#00d4aa">
            </div>
            <div class="control-group">
                <label></label>
                <label><input type="checkbox" id="transparentBg"> Transparent Background</label>
            </div>
        </div>

        <div class="preview-row">
            <div class="icon-preview">
                <canvas id="c16" width="16" height="16"></canvas>
                <span>16px</span>
            </div>
            <div class="icon-preview">
                <canvas id="c48" width="48" height="48"></canvas>
                <span>48px</span>
            </div>
            <div class="icon-preview">
                <canvas id="c128" width="128" height="128"></canvas>
                <span>128px</span>
            </div>
        </div>

        <button id="downloadAll">3. Download All Icons</button>
    </div>

    <script>
        // Default SVG content embedded to avoid file:// CORS issues
        const DEFAULT_SVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path fill="#ffffff" d="M128 128C92.7 128 64 156.7 64 192L64 448C64 483.3 92.7 512 128 512L384 512C419.3 512 448 483.3 448 448L448 192C448 156.7 419.3 128 384 128L128 128zM496 400L569.5 458.8C573.7 462.2 578.9 464 584.3 464C597.4 464 608 453.4 608 440.3L608 199.7C608 186.6 597.4 176 584.3 176C578.9 176 573.7 177.8 569.5 181.2L496 240L496 400z"/></svg>`;

        let currentSvgContent = DEFAULT_SVG;

        const canvases = {
            16: document.getElementById('c16'),
            48: document.getElementById('c48'),
            128: document.getElementById('c128')
        };
        const ctxs = {
            16: canvases[16].getContext('2d'),
            48: canvases[48].getContext('2d'),
            128: canvases[128].getContext('2d')
        };

        const iconColorInput = document.getElementById('iconColor');
        const bgColorInput = document.getElementById('bgColor');
        const transparentBgInput = document.getElementById('transparentBg');
        const svgInput = document.getElementById('svgInput');

        svgInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentSvgContent = e.target.result;
                    renderAll();
                };
                reader.readAsText(file);
            }
        });

        function renderAll() {
            const iconColor = iconColorInput.value;
            const bgColor = bgColorInput.value;
            const isTransparent = transparentBgInput.checked;

            // Modify SVG Color
            let coloredSvg = currentSvgContent;
            
            // Try to find fill attributes and replace them
            // This is a simple regex replace, might not cover all SVG cases but works for standard icons
            if (coloredSvg.includes('fill=')) {
                // Replace existing fills
                coloredSvg = coloredSvg.replace(/fill="[^"]*"/g, `fill="${iconColor}"`);
                coloredSvg = coloredSvg.replace(/fill='[^']*'/g, `fill='${iconColor}'`);
            } else {
                // Add fill to paths if missing
                coloredSvg = coloredSvg.replace(/<path/g, `<path fill="${iconColor}"`);
                coloredSvg = coloredSvg.replace(/<rect/g, `<rect fill="${iconColor}"`);
                coloredSvg = coloredSvg.replace(/<circle/g, `<circle fill="${iconColor}"`);
            }

            const blob = new Blob([coloredSvg], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            const img = new Image();
            
            img.onload = () => {
                Object.keys(canvases).forEach(size => {
                    const ctx = ctxs[size];
                    const canvas = canvases[size];
                    
                    // Clear
                    ctx.clearRect(0, 0, size, size);

                    // Draw Background
                    if (!isTransparent) {
                        ctx.fillStyle = bgColor;
                        ctx.beginPath();
                        ctx.arc(size/2, size/2, size/2, 0, Math.PI * 2);
                        ctx.fill();
                    }

                    // Draw Icon (centered and scaled)
                    const iconSize = size * 0.6; // 60% of container
                    const offset = (size - iconSize) / 2;
                    
                    ctx.drawImage(img, offset, offset, iconSize, iconSize);
                });
                URL.revokeObjectURL(url);
            };
            img.src = url;
        }

        [iconColorInput, bgColorInput, transparentBgInput].forEach(el => {
            el.addEventListener('input', () => renderAll());
            el.addEventListener('change', () => renderAll());
        });

        document.getElementById('downloadAll').addEventListener('click', async () => {
            const sizes = [16, 48, 128];
            for (const size of sizes) {
                const link = document.createElement('a');
                link.download = `icon${size}.png`;
                link.href = canvases[size].toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                // Small delay to ensure browser handles multiple downloads
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        });

        // Initial render
        renderAll();

    </script>
</body>
</html>
